<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ· é…’è’™å­åä¼š - 2026é¥®é…’ç»Ÿè®¡ï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* åŸæœ‰CSSæ ·å¼ä¿æŒä¸å˜ï¼Œæ·»åŠ ç½‘ç»œçŠ¶æ€å’Œä¿å­˜çŠ¶æ€æ ·å¼ */
        :root {
            /* ä¸»è‰²è°ƒ - æ·±ç´«çº¢è‰²è°ƒ */
            --primary-color: #7C3AED;
            --primary-light: #8B5CF6;
            --primary-dark: #6D28D9;
            
            /* è¾…åŠ©è‰² */
            --secondary-color: #10B981;
            --accent-gold: #F59E0B;
            --accent-silver: #9CA3AF;
            --accent-bronze: #B45309;
            
            /* é…’ç±»ä¸“å±è‰² */
            --wine-baijiu: #FBBF24;      /* ç™½é…’ - ç¥ç€é‡‘ */
            --wine-beer: #3B82F6;        /* å•¤é…’ - å¤©è“è‰² */
            --wine-red: #EF4444;         /* çº¢é…’ - çŠç‘šçº¢ */
            --wine-qingdao: #06B6D4;     /* é’å²›ç»å…¸ - é’è“è‰² */
            
            /* ä¸­æ€§è‰² */
            --light-bg: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --text-light: #9CA3AF;
            --border-color: #E5E7EB;
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 6px 20px rgba(0, 0, 0, 0.08);
            --shadow-heavy: 0 10px 30px rgba(0, 0, 0, 0.12);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* æš—è‰²ä¸»é¢˜æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            :root {
                --light-bg: #111827;
                --card-bg: #1F2937;
                --text-primary: #F9FAFB;
                --text-secondary: #D1D5DB;
                --text-light: #9CA3AF;
                --border-color: #374151;
                --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.25);
                --shadow-medium: 0 6px 20px rgba(0, 0, 0, 0.3);
                --shadow-heavy: 0 10px 30px rgba(0, 0, 0, 0.35);
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 40px 40px 30px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.1;
            z-index: 0;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo-icon {
            font-size: 3.5rem;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }
        
        .logo-text h1 {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(to right, #FFFFFF, #FDE68A);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .logo-text .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* ç½‘ç»œçŠ¶æ€æ ·å¼ */
        .network-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .network-online {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(52, 211, 153, 0.9));
            color: white;
        }
        
        .network-offline {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(248, 113, 113, 0.9));
            color: white;
        }
        
        .date-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.15);
            padding: 14px 22px;
            border-radius: var(--radius-lg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .date-selector label {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .date-selector input {
            padding: 12px 18px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            background-color: rgba(255, 255, 255, 0.95);
            color: var(--text-primary);
            width: 200px;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .date-selector input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }
        
        .header-info {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }
        
        .conversion-info {
            background: rgba(255, 255, 255, 0.12);
            border-radius: var(--radius-lg);
            padding: 20px 25px;
            flex: 1;
            min-width: 350px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .conversion-info h4 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #FDE68A;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }
        
        .conversion-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .conversion-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .conversion-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .conversion-equivalent {
            color: #FDE68A;
            font-weight: 700;
            font-size: 1.05rem;
        }
        
        .members-list {
            background: rgba(255, 255, 255, 0.12);
            border-radius: var(--radius-lg);
            padding: 20px 25px;
            flex: 1;
            min-width: 300px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .members-list h4 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #FDE68A;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }
        
        .members-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .member-tag {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            color: white;
        }
        
        .member-tag:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
            position: relative;
            z-index: 1;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), #34D399);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #3B82F6, #60A5FA);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #F59E0B, #FBBF24);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #06B6D4, #22D3EE);
            color: white;
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #8B5CF6, #A78BFA);
            color: white;
        }
        
        /* ä¸»ä½“å†…å®¹æ ·å¼ */
        main {
            padding: 40px 40px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 40px;
            border-bottom: 2px solid var(--border-color);
            gap: 5px;
        }
        
        .tab {
            padding: 18px 35px;
            background: none;
            border: none;
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
        }
        
        .tab:hover {
            color: var(--primary-color);
            background: rgba(124, 58, 237, 0.05);
        }
        
        .tab.active {
            color: var(--primary-color);
            background: rgba(124, 58, 237, 0.08);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, var(--primary-color), var(--primary-light));
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 50px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            background: var(--card-bg);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1100px;
        }
        
        th {
            background-color: #F9FAFB;
            padding: 22px 18px;
            text-align: center;
            font-weight: 700;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            position: sticky;
            top: 0;
            font-size: 1.05rem;
        }
        
        @media (prefers-color-scheme: dark) {
            th {
                background-color: #374151;
            }
        }
        
        .wine-header {
            background: linear-gradient(135deg, var(--wine-baijiu), #FCD34D);
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .wine-header-beer {
            background: linear-gradient(135deg, var(--wine-beer), #60A5FA);
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .wine-header-red {
            background: linear-gradient(135deg, var(--wine-red), #FCA5A5);
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .wine-header-qingdao {
            background: linear-gradient(135deg, var(--wine-qingdao), #67E8F9);
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        td {
            padding: 20px 18px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        tr:hover td {
            background-color: rgba(124, 58, 237, 0.03);
        }
        
        @media (prefers-color-scheme: dark) {
            tr:hover td {
                background-color: rgba(124, 58, 237, 0.1);
            }
        }
        
        .member-name {
            font-weight: 700;
            color: var(--text-primary);
            background-color: rgba(124, 58, 237, 0.03);
            text-align: left;
            padding-left: 25px;
            font-size: 1.1rem;
        }
        
        .input-cell {
            padding: 8px;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            text-align: center;
            font-size: 1.1rem;
            transition: var(--transition);
            background-color: var(--card-bg);
            color: var(--text-primary);
            font-weight: 500;
        }
        
        input[type="number"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
            outline: none;
        }
        
        .unit-display {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 6px;
            font-weight: 500;
            opacity: 0.9;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }
        
        .stat-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--primary-light));
        }
        
        .stat-card:hover {
            box-shadow: var(--shadow-heavy);
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            color: var(--text-primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            transition: var(--transition);
        }
        
        .stat-item:hover {
            background-color: rgba(124, 58, 237, 0.03);
            padding-left: 10px;
            padding-right: 10px;
            border-radius: var(--radius-sm);
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-info {
            display: flex;
            align-items: center;
            gap: 18px;
            flex: 1;
        }
        
        .rank-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .rank-1 {
            background: linear-gradient(135deg, #F59E0B, #FBBF24);
            color: white;
        }
        
        .rank-2 {
            background: linear-gradient(135deg, #9CA3AF, #D1D5DB);
            color: white;
        }
        
        .rank-3 {
            background: linear-gradient(135deg, #B45309, #D97706);
            color: white;
        }
        
        .rank-other {
            background: linear-gradient(135deg, #E5E7EB, #F3F4F6);
            color: var(--text-secondary);
        }
        
        @media (prefers-color-scheme: dark) {
            .rank-other {
                background: linear-gradient(135deg, #374151, #4B5563);
                color: var(--text-light);
            }
        }
        
        .member-details {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .member-name-rank {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1.05rem;
        }
        
        .member-wine-details {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            gap: 12px;
            margin-top: 6px;
            flex-wrap: wrap;
        }
        
        .wine-badge {
            display: inline-block;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .wine-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .wine-baijiu {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(251, 191, 36, 0.25));
            color: #D97706;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        .wine-beer {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.25));
            color: #2563EB;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .wine-red {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.25));
            color: #DC2626;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .wine-qingdao {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(6, 182, 212, 0.25));
            color: #0891B2;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }
        
        .total-count {
            font-weight: 800;
            font-size: 1.3rem;
            color: var(--primary-color);
            text-align: right;
        }
        
        .equivalent-count {
            font-size: 0.95rem;
            color: var(--text-light);
            margin-top: 5px;
            font-weight: 400;
        }
        
        .chart-container {
            margin-top: 50px;
            height: 350px;
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--primary-light));
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .selector-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 25px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-color);
            flex-wrap: wrap;
        }
        
        .selector-container label {
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .selector-container select {
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background-color: var(--card-bg);
            color: var(--text-primary);
            min-width: 200px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .selector-container select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
        }
        
        .save-status {
            position: fixed;
            bottom: 40px;
            right: 40px;
            padding: 20px 30px;
            border-radius: var(--radius-lg);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: var(--shadow-heavy);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            transform: translateY(30px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .save-status.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .save-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.95), rgba(52, 211, 153, 0.95));
            color: white;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .save-error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(248, 113, 113, 0.95));
            color: white;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .save-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.95), rgba(251, 191, 36, 0.95));
            color: white;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .save-info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.95), rgba(96, 165, 250, 0.95));
            color: white;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-light);
            font-size: 0.95rem;
            border-top: 1px solid var(--border-color);
            background: rgba(124, 58, 237, 0.03);
        }
        
        footer p {
            margin-bottom: 10px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        #dataStats {
            color: var(--primary-color);
            font-weight: 800;
            font-size: 1.1rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 40px;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 25px;
            color: var(--border-color);
            opacity: 0.5;
        }
        
        .empty-state p {
            font-size: 1.2rem;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1400px) {
            .container {
                max-width: 95%;
            }
        }
        
        @media (max-width: 1200px) {
            .header-top {
                flex-direction: column;
                align-items: flex-start;
                gap: 25px;
            }
            
            .date-selector {
                width: 100%;
            }
            
            .date-selector input {
                flex: 1;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 992px) {
            header, main {
                padding: 30px 25px;
            }
            
            .logo-text h1 {
                font-size: 2.4rem;
            }
            
            .logo-icon {
                font-size: 3rem;
            }
            
            .controls {
                justify-content: center;
            }
            
            .btn {
                flex: 1;
                min-width: 200px;
            }
            
            .network-status {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 15px;
                align-self: flex-start;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: var(--radius-lg);
            }
            
            header, main {
                padding: 25px 20px;
            }
            
            .logo {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .logo-text h1 {
                font-size: 2.2rem;
            }
            
            .logo-icon {
                font-size: 2.8rem;
            }
            
            .tab {
                padding: 15px 20px;
                font-size: 1rem;
                flex: 1;
                justify-content: center;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .header-info {
                flex-direction: column;
            }
            
            .conversion-info, .members-list {
                min-width: 100%;
            }
            
            .stat-card {
                padding: 25px 20px;
            }
            
            .chart-container {
                height: 300px;
                padding: 25px 20px;
            }
            
            .selector-container {
                flex-direction: column;
                align-items: flex-start;
                padding: 20px;
            }
            
            .selector-container select {
                width: 100%;
            }
            
            .save-status {
                bottom: 20px;
                right: 20px;
                left: 20px;
                padding: 15px 20px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .logo-text h1 {
                font-size: 1.8rem;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 0.95rem;
            }
            
            .conversion-items, .members-tags {
                justify-content: center;
            }
            
            .stat-card h3 {
                font-size: 1.2rem;
            }
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-glass-cheers"></i>
                    </div>
                    <div class="logo-text">
                        <h1>é…’è’™å­åä¼š</h1>
                        <div class="subtitle">2026å¹´åº¦é¥®é…’ç»Ÿè®¡ Â· äº‘ç«¯åŒæ­¥ç‰ˆ</div>
                    </div>
                </div>
                
                <div class="date-selector">
                    <label for="datePicker"><i class="far fa-calendar-alt"></i> é€‰æ‹©æ—¥æœŸï¼š</label>
                    <input type="date" id="datePicker" min="2026-01-01" max="2026-12-31">
                </div>
            </div>
            
            <div class="header-info">
                <div class="conversion-info">
                    <h4><i class="fas fa-exchange-alt"></i> å•ä½æ¢ç®—æ ‡å‡†</h4>
                    <div class="conversion-items">
                        <div class="conversion-item">
                            <span>1æ¯ç™½é…’ = <span class="conversion-equivalent">3ç“¶å•¤é…’</span></span>
                        </div>
                        <div class="conversion-item">
                            <span>1ç“¶çº¢é…’ = <span class="conversion-equivalent">4.125ç“¶å•¤é…’</span></span>
                        </div>
                        <div class="conversion-item">
                            <span>1ç“¶é’å²›ç»å…¸ = <span class="conversion-equivalent">0.775ç“¶å•¤é…’</span></span>
                        </div>
                        <div class="conversion-item">
                            <span>æ‰€æœ‰ç»Ÿè®¡æŒ‰<span class="conversion-equivalent">å•¤é…’</span>è®¡ç®—</span>
                        </div>
                    </div>
                </div>
                
                <div class="members-list">
                    <h4><i class="fas fa-users"></i> åä¼šæˆå‘˜</h4>
                    <div class="members-tags">
                        <div class="member-tag">ç‹ä¸¹</div>
                        <div class="member-tag">é²ä¸œé˜³</div>
                        <div class="member-tag">å¾å©·å©·</div>
                        <div class="member-tag">é©¬é“­</div>
                        <div class="member-tag">ç‹é›ªè¹</div>
                        <div class="member-tag">æ¨æµ©</div>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn btn-secondary" id="exportBtn">
                    <i class="fas fa-file-excel"></i> å¯¼å‡ºå½“æ—¥
                </button>
                <button class="btn btn-purple" id="exportCurrentMonthBtn">
                    <i class="fas fa-file-export"></i> å¯¼å‡ºå½“æœˆ
                </button>
                <button class="btn btn-warning" id="clearBtn">
                    <i class="fas fa-broom"></i> æ¸…ç©ºä»Šæ—¥
                </button>
                <button class="btn btn-info" id="exportAllBtn">
                    <i class="fas fa-download"></i> å¯¼å‡ºå…¨å¹´
                </button>
                <button class="btn btn-primary" id="importBtn">
                    <i class="fas fa-file-import"></i> å¯¼å…¥æ•°æ®
                </button>
                <button class="btn btn-info" id="syncBtn">
                    <i class="fas fa-cloud-upload-alt"></i> åŒæ­¥æœ¬åœ°æ•°æ®
                </button>
                <input type="file" id="importFile" accept=".xlsx,.xls" style="display: none;">
            </div>
        </header>
        
        <main>
            <div class="tabs">
                <button class="tab active" data-tab="daily">
                    <i class="fas fa-calendar-day"></i> æ¯æ—¥è®°å½•
                </button>
                <button class="tab" data-tab="monthly">
                    <i class="fas fa-chart-bar"></i> æœˆæ’å
                </button>
                <button class="tab" data-tab="yearly">
                    <i class="fas fa-trophy"></i> å¹´æ’å
                </button>
            </div>
            
            <!-- æ¯æ—¥è®°å½•æ ‡ç­¾é¡µ -->
            <div id="daily-tab" class="tab-content active">
                <div class="table-container">
                    <table id="drinkTable">
                        <thead>
                            <tr>
                                <th>æˆå‘˜</th>
                                <th class="wine-header">
                                    <div>ç™½é…’ (æ¯)</div>
                                    <div class="unit-display">1æ¯ = 3ç“¶å•¤é…’</div>
                                </th>
                                <th class="wine-header-beer">
                                    <div>å•¤é…’ (ç“¶)</div>
                                    <div class="unit-display">åŸºå‡†å•ä½</div>
                                </th>
                                <th class="wine-header-red">
                                    <div>çº¢é…’ (ç“¶)</div>
                                    <div class="unit-display">1ç“¶ = 4.125ç“¶å•¤é…’</div>
                                </th>
                                <th class="wine-header-qingdao">
                                    <div>é’å²›ç»å…¸ (ç“¶)</div>
                                    <div class="unit-display">1ç“¶ = 0.775ç“¶å•¤é…’</div>
                                </th>
                                <th>
                                    <div>å°è®¡</div>
                                    <div class="unit-display">å•¤é…’ (ç“¶)</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="stats-section">
                    <div class="stat-card">
                        <h3><i class="fas fa-chart-pie"></i> ä»Šæ—¥é¥®é…’ç»Ÿè®¡</h3>
                        <div id="dailySummary">
                            <!-- ä»Šæ—¥ç»Ÿè®¡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <h3><i class="fas fa-trophy"></i> ä»Šæ—¥ä¸ªäººæ’å</h3>
                        <div id="personalRanking">
                            <!-- ä¸ªäººæ’åå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æœˆæ’åæ ‡ç­¾é¡µ -->
            <div id="monthly-tab" class="tab-content">
                <div class="selector-container">
                    <label for="monthSelect"><i class="far fa-calendar"></i> é€‰æ‹©æœˆä»½ï¼š</label>
                    <select id="monthSelect">
                        <option value="01">2026å¹´1æœˆ</option>
                        <option value="02">2026å¹´2æœˆ</option>
                        <option value="03">2026å¹´3æœˆ</option>
                        <option value="04">2026å¹´4æœˆ</option>
                        <option value="05">2026å¹´5æœˆ</option>
                        <option value="06">2026å¹´6æœˆ</option>
                        <option value="07">2026å¹´7æœˆ</option>
                        <option value="08">2026å¹´8æœˆ</option>
                        <option value="09">2026å¹´9æœˆ</option>
                        <option value="10">2026å¹´10æœˆ</option>
                        <option value="11">2026å¹´11æœˆ</option>
                        <option value="12">2026å¹´12æœˆ</option>
                    </select>
                    <button class="btn btn-secondary" id="exportMonthBtn">
                        <i class="fas fa-file-excel"></i> å¯¼å‡ºæœ¬æœˆæ•°æ®
                    </button>
                </div>
                
                <div class="stat-card">
                    <h3><i class="fas fa-trophy"></i> æœˆåº¦é¥®é…’æ’å</h3>
                    <div id="monthlyRanking">
                        <!-- æœˆåº¦æ’åå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
            
            <!-- å¹´æ’åæ ‡ç­¾é¡µ -->
            <div id="yearly-tab" class="tab-content">
                <div class="selector-container">
                    <label for="yearSelect"><i class="fas fa-calendar-alt"></i> å¹´åº¦ï¼š</label>
                    <select id="yearSelect">
                        <option value="2026">2026å¹´</option>
                    </select>
                    <button class="btn btn-secondary" id="exportYearBtn">
                        <i class="fas fa-file-excel"></i> å¯¼å‡ºå…¨å¹´æ•°æ®
                    </button>
                </div>
                
                <div class="stat-card">
                    <h3><i class="fas fa-crown"></i> å¹´åº¦é¥®é…’æ’å</h3>
                    <div id="yearlyRanking">
                        <!-- å¹´åº¦æ’åå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="yearlyChart"></canvas>
                </div>
            </div>
        </main>
        
        <footer>
            <p>é…’è’™å­åä¼š &copy; 2026 | æ•°æ®å·²å¯ç”¨äº‘ç«¯åŒæ­¥åŠŸèƒ½ï¼Œæ”¯æŒç¦»çº¿ç¼–è¾‘</p>
            <p>å½“å‰æ•°æ®ç»Ÿè®¡ï¼š<span id="dataStats">0å¤©è®°å½•ï¼Œ0ç“¶å•¤é…’</span></p>
        </footer>
    </div>
    
    <div id="saveStatus" class="save-status"></div>

    <script>
        // ==================== é…ç½®éƒ¨åˆ† ====================
        // åä¼šæˆå‘˜åˆ—è¡¨
        const members = ['ç‹ä¸¹', 'é²ä¸œé˜³', 'å¾å©·å©·', 'é©¬é“­', 'ç‹é›ªè¹', 'æ¨æµ©'];
        
        // é…’ç±»åˆ—è¡¨ï¼ˆåŒ…å«æ¢ç®—æ¯”ä¾‹ï¼‰
        const wineTypes = [
            { id: 'baijiu', name: 'ç™½é…’', unit: 'æ¯', conversionRate: 3, className: 'wine-baijiu', color: '#FBBF24' },
            { id: 'beer', name: 'å•¤é…’', unit: 'ç“¶', conversionRate: 1, className: 'wine-beer', color: '#3B82F6' },
            { id: 'red', name: 'çº¢é…’', unit: 'ç“¶', conversionRate: 4.125, className: 'wine-red', color: '#EF4444' },
            { id: 'qingdao', name: 'é’å²›ç»å…¸', unit: 'ç“¶', conversionRate: 0.775, className: 'wine-qingdao', color: '#06B6D4' }
        ];
        
        // æœˆä»½åˆ—è¡¨
        const months = [
            { id: '01', name: '1æœˆ' },
            { id: '02', name: '2æœˆ' },
            { id: '03', name: '3æœˆ' },
            { id: '04', name: '4æœˆ' },
            { id: '05', name: '5æœˆ' },
            { id: '06', name: '6æœˆ' },
            { id: '07', name: '7æœˆ' },
            { id: '08', name: '8æœˆ' },
            { id: '09', name: '9æœˆ' },
            { id: '10', name: '10æœˆ' },
            { id: '11', name: '11æœˆ' },
            { id: '12', name: '12æœˆ' }
        ];
        
        // ==================== APIé…ç½® ====================
        // é‡è¦ï¼šå°†ä¸‹é¢çš„URLä¿®æ”¹ä¸ºä½ çš„å®é™…åç«¯APIåœ°å€
        // æœ¬åœ°æµ‹è¯•ï¼šhttp://localhost:3000
        // çº¿ä¸Šéƒ¨ç½²ï¼šhttps://ä½ çš„åç«¯æœåŠ¡åœ°å€.vercel.app
        const API_BASE_URL = 'https://jiu-mengzi-stats.vercel.app'; // ä¿®æ”¹ä¸ºå®é™…åœ°å€
        
        // ==================== å…¨å±€å˜é‡ ====================
        let drinkData = {}; // å­˜å‚¨æ‰€æœ‰æ•°æ®
        let isOnline = true; // ç½‘ç»œçŠ¶æ€
        let syncQueue = []; // åŒæ­¥é˜Ÿåˆ—ï¼Œç”¨äºç¦»çº¿æ—¶ç¼“å­˜æ“ä½œ
        
        // ==================== DOMå…ƒç´  ====================
        const datePicker = document.getElementById('datePicker');
        const tableBody = document.getElementById('tableBody');
        const exportBtn = document.getElementById('exportBtn');
        const exportCurrentMonthBtn = document.getElementById('exportCurrentMonthBtn');
        const clearBtn = document.getElementById('clearBtn');
        const exportAllBtn = document.getElementById('exportAllBtn');
        const importBtn = document.getElementById('importBtn');
        const importFile = document.getElementById('importFile');
        const saveStatus = document.getElementById('saveStatus');
        const monthSelect = document.getElementById('monthSelect');
        const yearSelect = document.getElementById('yearSelect');
        const exportMonthBtn = document.getElementById('exportMonthBtn');
        const exportYearBtn = document.getElementById('exportYearBtn');
        const dataStats = document.getElementById('dataStats');
        const syncBtn = document.getElementById('syncBtn');
        
        // ==================== å›¾è¡¨å®ä¾‹ ====================
        let monthlyChart = null;
        let yearlyChart = null;
        
        // ==================== ç½‘ç»œçŠ¶æ€ç›‘æµ‹ ====================
        function updateNetworkStatus() {
            const statusElement = document.getElementById('networkStatus') || createNetworkStatusElement();
            if (navigator.onLine) {
                isOnline = true;
                statusElement.className = 'network-status network-online';
                statusElement.innerHTML = '<i class="fas fa-wifi"></i> å·²è¿æ¥';
                // å¦‚æœä¹‹å‰ç¦»çº¿ï¼Œç°åœ¨æ¢å¤åœ¨çº¿ï¼Œå°è¯•åŒæ­¥é˜Ÿåˆ—ä¸­çš„æ“ä½œ
                if (syncQueue.length > 0) {
                    setTimeout(processSyncQueue, 2000);
                }
            } else {
                isOnline = false;
                statusElement.className = 'network-status network-offline';
                statusElement.innerHTML = '<i class="fas fa-wifi-slash"></i> ç¦»çº¿ä¸­';
            }
        }
        
        function createNetworkStatusElement() {
            const statusElement = document.createElement('div');
            statusElement.id = 'networkStatus';
            document.querySelector('.header-top').appendChild(statusElement);
            return statusElement;
        }
        
        // ==================== APIé€šä¿¡å‡½æ•° ====================
        async function saveDataToCloud(date, data) {
            if (!isOnline) {
                // ç¦»çº¿æ—¶ï¼Œå°†æ“ä½œåŠ å…¥é˜Ÿåˆ—
                syncQueue.push({ type: 'save', date, data: JSON.parse(JSON.stringify(data)) });
                localStorage.setItem('syncQueue', JSON.stringify(syncQueue));
                localStorage.setItem(`drinkData_${date}`, JSON.stringify(data));
                showStatus('å·²ä¿å­˜åˆ°æœ¬åœ°ï¼ˆç¦»çº¿æ¨¡å¼ï¼‰', 'info');
                return false;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/save`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        date,
                        data,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯ï¼', 'success');
                    return true;
                } else {
                    throw new Error(result.message || 'ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å’ŒåŒæ­¥é˜Ÿåˆ—
                syncQueue.push({ type: 'save', date, data: JSON.parse(JSON.stringify(data)) });
                localStorage.setItem('syncQueue', JSON.stringify(syncQueue));
                localStorage.setItem(`drinkData_${date}`, JSON.stringify(data));
                showStatus('ç½‘ç»œå¼‚å¸¸ï¼Œå·²ä¿å­˜åˆ°æœ¬åœ°', 'warning');
                return false;
            }
        }
        
        async function loadDataFromCloud() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/load`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    return result.data || {};
                } else {
                    console.error('åŠ è½½å¤±è´¥:', result.message);
                    return {};
                }
            } catch (error) {
                console.error('ä»äº‘ç«¯åŠ è½½å¤±è´¥:', error);
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
                return loadDataFromLocal();
            }
        }
        
        async function processSyncQueue() {
            if (!isOnline || syncQueue.length === 0) return;
            
            showStatus('æ­£åœ¨åŒæ­¥ç¦»çº¿æ•°æ®...', 'info');
            
            const queueCopy = [...syncQueue];
            const failedOperations = [];
            
            for (const operation of queueCopy) {
                try {
                    const success = await saveDataToCloud(operation.date, operation.data);
                    if (success) {
                        // ä»é˜Ÿåˆ—ä¸­ç§»é™¤æˆåŠŸçš„æ“ä½œ
                        syncQueue = syncQueue.filter(op => 
                            !(op.date === operation.date && op.type === operation.type)
                        );
                    } else {
                        failedOperations.push(operation);
                    }
                } catch (error) {
                    console.error('åŒæ­¥æ“ä½œå¤±è´¥:', error);
                    failedOperations.push(operation);
                }
            }
            
            syncQueue = failedOperations;
            localStorage.setItem('syncQueue', JSON.stringify(syncQueue));
            
            if (failedOperations.length === 0) {
                showStatus('ç¦»çº¿æ•°æ®åŒæ­¥å®Œæˆï¼', 'success');
            } else {
                showStatus(`éƒ¨åˆ†æ•°æ®åŒæ­¥å¤±è´¥ï¼Œè¿˜æœ‰${failedOperations.length}æ¡å¾…åŒæ­¥`, 'warning');
            }
        }
        
        // ==================== æœ¬åœ°å­˜å‚¨å‡½æ•° ====================
        function loadDataFromLocal() {
            const localData = {};
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ‰€æœ‰æ—¥æœŸçš„æ•°æ®
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('drinkData_')) {
                    const date = key.replace('drinkData_', '');
                    try {
                        localData[date] = JSON.parse(localStorage.getItem(key));
                    } catch (e) {
                        console.error(`è§£ææœ¬åœ°æ•°æ®å¤±è´¥ ${key}:`, e);
                    }
                }
            }
            
            // åŠ è½½åŒæ­¥é˜Ÿåˆ—
            const queueStr = localStorage.getItem('syncQueue');
            if (queueStr) {
                try {
                    syncQueue = JSON.parse(queueStr);
                } catch (e) {
                    console.error('è§£æåŒæ­¥é˜Ÿåˆ—å¤±è´¥:', e);
                    syncQueue = [];
                }
            }
            
            return localData;
        }
        
        function saveDataToLocal(date, data) {
            try {
                localStorage.setItem(`drinkData_${date}`, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:', e);
                return false;
            }
        }
        
        // ==================== åˆå§‹åŒ–å‡½æ•° ====================
        async function initializeData() {
            // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
            updateNetworkStatus();
            
            // ä»äº‘ç«¯åŠ è½½æ•°æ®
            showStatus('æ­£åœ¨ä»äº‘ç«¯åŠ è½½æ•°æ®...', 'info');
            const cloudData = await loadDataFromCloud();
            
            // ä»æœ¬åœ°åŠ è½½æ•°æ®
            const localData = loadDataFromLocal();
            
            // åˆå¹¶æ•°æ®ï¼šäº‘ç«¯æ•°æ®ä¼˜å…ˆï¼Œæœ¬åœ°æ•°æ®ä½œä¸ºè¡¥å……
            drinkData = { ...localData, ...cloudData };
            
            // æ›´æ–°ç»Ÿè®¡
            updateDataStats();
            
            // å¤„ç†åŒæ­¥é˜Ÿåˆ—
            if (isOnline && syncQueue.length > 0) {
                setTimeout(processSyncQueue, 1000);
            }
            
            showStatus('æ•°æ®åŠ è½½å®Œæˆï¼', 'success');
        }
        
        // ==================== æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ====================
        // è®¡ç®—å•¤é…’æ€»é‡
        function calculateBeer(baijiu, beer, red, qingdao) {
            return (baijiu * 3) + (beer * 1) + (red * 4.125) + (qingdao * 0.775);
        }
        
        // æ›´æ–°æ•°æ®ç»Ÿè®¡
        function updateDataStats() {
            const daysCount = Object.keys(drinkData).length;
            let totalBeer = 0;
            
            Object.values(drinkData).forEach(dateData => {
                Object.values(dateData).forEach(memberData => {
                    totalBeer += calculateBeer(
                        parseFloat(memberData.baijiu) || 0,
                        parseFloat(memberData.beer) || 0,
                        parseFloat(memberData.red) || 0,
                        parseFloat(memberData.qingdao) || 0
                    );
                });
            });
            
            dataStats.textContent = `${daysCount}å¤©è®°å½•ï¼Œ${totalBeer.toFixed(1)}ç“¶å•¤é…’`;
            
            // å¦‚æœæœ‰ç¦»çº¿æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º
            if (syncQueue.length > 0 && !isOnline) {
                dataStats.textContent += ` (${syncQueue.length}æ¡å¾…åŒæ­¥)`;
                dataStats.style.color = '#F59E0B';
            } else {
                dataStats.style.color = 'var(--primary-color)';
            }
        }
        
        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type) {
            saveStatus.textContent = message;
            saveStatus.className = 'save-status';
            saveStatus.classList.add(type === 'success' ? 'save-success' : 
                                   type === 'error' ? 'save-error' : 
                                   type === 'warning' ? 'save-warning' : 'save-info');
            saveStatus.classList.add('show');
            
            // 3ç§’åéšè—çŠ¶æ€
            setTimeout(() => {
                saveStatus.classList.remove('show');
                setTimeout(() => {
                    saveStatus.className = 'save-status';
                }, 500);
            }, 3000);
        }
        
        // è·å–å½“å‰æ—¥æœŸçš„æ•°æ®
        function getCurrentDateData() {
            const date = datePicker.value;
            if (!drinkData[date]) {
                // å¦‚æœè¯¥æ—¥æœŸæ²¡æœ‰æ•°æ®ï¼Œåˆå§‹åŒ–
                drinkData[date] = {};
                members.forEach(member => {
                    drinkData[date][member] = {
                        baijiu: 0,
                        beer: 0,
                        red: 0,
                        qingdao: 0
                    };
                });
            }
            return drinkData[date];
        }
        
        // æ›´æ–°è¡¨æ ¼
        function updateTable() {
            const dateData = getCurrentDateData();
            
            // æ¸…ç©ºè¡¨æ ¼
            tableBody.innerHTML = '';
            
            // å¡«å……è¡¨æ ¼æ•°æ®
            members.forEach(member => {
                const row = document.createElement('tr');
                
                // æˆå‘˜å§“åå•å…ƒæ ¼
                const nameCell = document.createElement('td');
                nameCell.className = 'member-name';
                nameCell.textContent = member;
                row.appendChild(nameCell);
                
                let memberTotal = 0;
                
                // æ¯ç§é…’ç±»çš„è¾“å…¥å•å…ƒæ ¼
                wineTypes.forEach(wine => {
                    const inputCell = document.createElement('td');
                    inputCell.className = 'input-cell';
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '0';
                    input.step = '0.5';
                    input.value = dateData[member][wine.id];
                    input.dataset.member = member;
                    input.dataset.wine = wine.id;
                    input.placeholder = '0.0';
                    
                    // è¾“å…¥äº‹ä»¶ç›‘å¬
                    input.addEventListener('input', async function() {
                        const value = parseFloat(this.value) || 0;
                        const wineId = this.dataset.wine;
                        const member = this.dataset.member;
                        const date = datePicker.value;
                        
                        // æ›´æ–°å†…å­˜ä¸­çš„æ•°æ®
                        if (!drinkData[date]) {
                            drinkData[date] = {};
                        }
                        if (!drinkData[date][member]) {
                            drinkData[date][member] = {
                                baijiu: 0,
                                beer: 0,
                                red: 0,
                                qingdao: 0
                            };
                        }
                        
                        drinkData[date][member][wineId] = value;
                        
                        // æ›´æ–°æœ¬åœ°å­˜å‚¨
                        saveDataToLocal(date, drinkData[date]);
                        
                        // æ›´æ–°UI
                        const memberTotal = calculateMemberTotal(drinkData[date][member]);
                        updateMemberTotal(row, memberTotal);
                        updateSummaries();
                        updateDataStats();
                        
                        // ä¿å­˜åˆ°äº‘ç«¯ï¼ˆå¸¦é˜²æŠ–ï¼‰
                        debouncedSave(date, drinkData[date]);
                    });
                    
                    inputCell.appendChild(input);
                    row.appendChild(inputCell);
                });
                
                // è®¡ç®—æˆå‘˜æ€»é‡ï¼ˆå•¤é…’ï¼‰
                const baijiu = parseFloat(dateData[member].baijiu) || 0;
                const beer = parseFloat(dateData[member].beer) || 0;
                const red = parseFloat(dateData[member].red) || 0;
                const qingdao = parseFloat(dateData[member].qingdao) || 0;
                memberTotal = calculateBeer(baijiu, beer, red, qingdao);
                
                // å°è®¡å•å…ƒæ ¼
                const totalCell = document.createElement('td');
                totalCell.className = 'member-total';
                totalCell.innerHTML = `
                    <div class="total-count">${memberTotal.toFixed(1)} ç“¶</div>
                    <div class="equivalent-count">(${baijiu.toFixed(1)}æ¯ç™½ + ${beer.toFixed(1)}ç“¶å•¤ + ${red.toFixed(1)}ç“¶çº¢ + ${qingdao.toFixed(1)}ç“¶é’)</div>
                `;
                totalCell.dataset.member = member;
                row.appendChild(totalCell);
                
                tableBody.appendChild(row);
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateSummaries();
            updateDataStats();
        }
        
        // è®¡ç®—æˆå‘˜æ€»é‡ï¼ˆå•¤é…’ï¼‰
        function calculateMemberTotal(memberData) {
            const baijiu = parseFloat(memberData.baijiu) || 0;
            const beer = parseFloat(memberData.beer) || 0;
            const red = parseFloat(memberData.red) || 0;
            const qingdao = parseFloat(memberData.qingdao) || 0;
            return calculateBeer(baijiu, beer, red, qingdao);
        }
        
        // æ›´æ–°æˆå‘˜æ€»é‡æ˜¾ç¤º
        function updateMemberTotal(row, total) {
            const totalCell = row.querySelector('.member-total');
            if (totalCell) {
                const baijiu = parseFloat(row.querySelector('input[data-wine="baijiu"]').value) || 0;
                const beer = parseFloat(row.querySelector('input[data-wine="beer"]').value) || 0;
                const red = parseFloat(row.querySelector('input[data-wine="red"]').value) || 0;
                const qingdao = parseFloat(row.querySelector('input[data-wine="qingdao"]').value) || 0;
                
                totalCell.innerHTML = `
                    <div class="total-count">${total.toFixed(1)} ç“¶</div>
                    <div class="equivalent-count">(${baijiu.toFixed(1)}æ¯ç™½ + ${beer.toFixed(1)}ç“¶å•¤ + ${red.toFixed(1)}ç“¶çº¢ + ${qingdao.toFixed(1)}ç“¶é’)</div>
                `;
            }
        }
        
        // é˜²æŠ–ä¿å­˜å‡½æ•°
        let saveTimeout;
        function debouncedSave(date, data) {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveDataToCloud(date, data);
            }, 1000); // 1ç§’åä¿å­˜
        }
        
        // ==================== ç»Ÿè®¡åŠŸèƒ½å‡½æ•° ====================
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateSummaries() {
            const dateData = getCurrentDateData();
            
            // è®¡ç®—æ€»é‡
            let totalBaijiu = 0, totalBeer = 0, totalRed = 0, totalQingdao = 0, grandTotal = 0;
            const memberTotals = [];
            
            members.forEach(member => {
                const memberData = dateData[member];
                const baijiu = parseFloat(memberData.baijiu) || 0;
                const beer = parseFloat(memberData.beer) || 0;
                const red = parseFloat(memberData.red) || 0;
                const qingdao = parseFloat(memberData.qingdao) || 0;
                const total = calculateBeer(baijiu, beer, red, qingdao);
                
                totalBaijiu += baijiu;
                totalBeer += beer;
                totalRed += red;
                totalQingdao += qingdao;
                grandTotal += total;
                
                memberTotals.push({
                    name: member,
                    total: total,
                    baijiu: baijiu,
                    beer: beer,
                    red: red,
                    qingdao: qingdao,
                    beerTotal: total
                });
            });
            
            // è®¡ç®—å•¤é…’
            const baijiuBeer = totalBaijiu * 3;
            const beerBeer = totalBeer * 1;
            const redBeer = totalRed * 4.125;
            const qingdaoBeer = totalQingdao * 0.775;
            
            // æ›´æ–°ä»Šæ—¥é¥®é…’ç»Ÿè®¡
            const dailySummary = document.getElementById('dailySummary');
            dailySummary.innerHTML = `
                <div class="stat-item">
                    <span>ç™½é…’æ€»é‡</span>
                    <span>${totalBaijiu.toFixed(1)} æ¯<br><span class="equivalent-count">${baijiuBeer.toFixed(1)}ç“¶å•¤é…’</span></span>
                </div>
                <div class="stat-item">
                    <span>å•¤é…’æ€»é‡</span>
                    <span>${totalBeer.toFixed(1)} ç“¶<br><span class="equivalent-count">${beerBeer.toFixed(1)}ç“¶å•¤é…’</span></span>
                </div>
                <div class="stat-item">
                    <span>çº¢é…’æ€»é‡</span>
                    <span>${totalRed.toFixed(1)} ç“¶<br><span class="equivalent-count">${redBeer.toFixed(1)}ç“¶å•¤é…’</span></span>
                </div>
                <div class="stat-item">
                    <span>é’å²›ç»å…¸æ€»é‡</span>
                    <span>${totalQingdao.toFixed(1)} ç“¶<br><span class="equivalent-count">${qingdaoBeer.toFixed(1)}ç“¶å•¤é…’</span></span>
                </div>
                <div class="stat-item">
                    <span><strong>ä»Šæ—¥æ€»è®¡</strong></span>
                    <span class="total-count"><strong>${grandTotal.toFixed(1)} ç“¶</strong><br><span class="equivalent-count">å•¤é…’</span></span>
                </div>
            `;
            
            // æ›´æ–°ä¸ªäººæ’å
            updatePersonalRanking(memberTotals);
        }
        
        // æ›´æ–°ä¸ªäººæ’å
        function updatePersonalRanking(memberTotals) {
            memberTotals.sort((a, b) => b.beerTotal - a.beerTotal);
            
            const personalRanking = document.getElementById('personalRanking');
            personalRanking.innerHTML = '';
            
            if (memberTotals.length === 0 || memberTotals.every(m => m.beerTotal === 0)) {
                personalRanking.innerHTML = '<div class="empty-state"><i class="fas fa-glass-cheers"></i><p>ä»Šæ—¥æš‚æ— é¥®é…’è®°å½•</p></div>';
                return;
            }
            
            memberTotals.forEach((member, index) => {
                if (member.beerTotal === 0) return;
                
                const rankingItem = document.createElement('div');
                rankingItem.className = 'stat-item';
                
                rankingItem.innerHTML = `
                    <div class="stat-info">
                        <div class="rank-number ${index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank-other'}">
                            ${index + 1}
                        </div>
                        <div class="member-details">
                            <div class="member-name-rank">${member.name}</div>
                            <div class="member-wine-details">
                                <span class="wine-badge wine-baijiu">ç™½ ${member.baijiu.toFixed(1)}æ¯</span>
                                <span class="wine-badge wine-beer">å•¤ ${member.beer.toFixed(1)}ç“¶</span>
                                <span class="wine-badge wine-red">çº¢ ${member.red.toFixed(1)}ç“¶</span>
                                <span class="wine-badge wine-qingdao">é’ ${member.qingdao.toFixed(1)}ç“¶</span>
                            </div>
                        </div>
                    </div>
                    <span class="total-count">${member.beerTotal.toFixed(1)} ç“¶</span>
                `;
                personalRanking.appendChild(rankingItem);
            });
        }
        
        // è®¡ç®—æœˆåº¦æ’å
        function calculateMonthlyRanking() {
            const selectedMonth = monthSelect.value;
            const monthData = {};
            
            // åˆå§‹åŒ–æˆå‘˜æ•°æ®
            members.forEach(member => {
                monthData[member] = {
                    baijiu: 0,
                    beer: 0,
                    red: 0,
                    qingdao: 0,
                    beerTotal: 0
                };
            });
            
            // éå†æ‰€æœ‰æ—¥æœŸï¼Œç­›é€‰å‡ºé€‰å®šæœˆä»½çš„æ•°æ®
            Object.entries(drinkData).forEach(([date, dateData]) => {
                if (date.startsWith(`2026-${selectedMonth}`)) {
                    Object.entries(dateData).forEach(([member, memberData]) => {
                        const baijiu = parseFloat(memberData.baijiu) || 0;
                        const beer = parseFloat(memberData.beer) || 0;
                        const red = parseFloat(memberData.red) || 0;
                        const qingdao = parseFloat(memberData.qingdao) || 0;
                        
                        monthData[member].baijiu += baijiu;
                        monthData[member].beer += beer;
                        monthData[member].red += red;
                        monthData[member].qingdao += qingdao;
                        monthData[member].beerTotal += calculateBeer(baijiu, beer, red, qingdao);
                    });
                }
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
            const rankingArray = members.map(member => ({
                name: member,
                baijiu: monthData[member].baijiu,
                beer: monthData[member].beer,
                red: monthData[member].red,
                qingdao: monthData[member].qingdao,
                beerTotal: monthData[member].beerTotal
            })).sort((a, b) => b.beerTotal - a.beerTotal);
            
            return rankingArray;
        }
        
        // æ›´æ–°æœˆåº¦æ’åæ˜¾ç¤º
        function updateMonthlyRanking() {
            const rankingArray = calculateMonthlyRanking();
            const monthlyRanking = document.getElementById('monthlyRanking');
            
            if (rankingArray.length === 0 || rankingArray.every(m => m.beerTotal === 0)) {
                monthlyRanking.innerHTML = '<div class="empty-state"><i class="fas fa-glass-cheers"></i><p>æœ¬æœˆæš‚æ— é¥®é…’è®°å½•</p></div>';
                return;
            }
            
            monthlyRanking.innerHTML = '';
            
            rankingArray.forEach((member, index) => {
                if (member.beerTotal === 0) return;
                
                const rankingItem = document.createElement('div');
                rankingItem.className = 'stat-item';
                
                rankingItem.innerHTML = `
                    <div class="stat-info">
                        <div class="rank-number ${index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank-other'}">
                            ${index + 1}
                        </div>
                        <div class="member-details">
                            <div class="member-name-rank">${member.name}</div>
                            <div class="member-wine-details">
                                <span class="wine-badge wine-baijiu">ç™½ ${member.baijiu.toFixed(1)}æ¯</span>
                                <span class="wine-badge wine-beer">å•¤ ${member.beer.toFixed(1)}ç“¶</span>
                                <span class="wine-badge wine-red">çº¢ ${member.red.toFixed(1)}ç“¶</span>
                                <span class="wine-badge wine-qingdao">é’ ${member.qingdao.toFixed(1)}ç“¶</span>
                            </div>
                        </div>
                    </div>
                    <span class="total-count">${member.beerTotal.toFixed(1)} ç“¶</span>
                `;
                monthlyRanking.appendChild(rankingItem);
            });
            
            // æ›´æ–°æœˆåº¦å›¾è¡¨
            updateMonthlyChart(rankingArray);
        }
        
        // æ›´æ–°æœˆåº¦å›¾è¡¨
        function updateMonthlyChart(rankingArray) {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            // é”€æ¯ä¹‹å‰çš„å›¾è¡¨
            if (monthlyChart) {
                monthlyChart.destroy();
            }
            
            // è¿‡æ»¤æ‰æ€»é‡ä¸º0çš„æˆå‘˜
            const filteredData = rankingArray.filter(member => member.beerTotal > 0);
            
            if (filteredData.length === 0) {
                document.getElementById('monthlyChart').style.display = 'none';
                return;
            }
            
            document.getElementById('monthlyChart').style.display = 'block';
            
            // è®¡ç®—å„ç±»é…’çš„å•¤é…’
            const baijiuData = filteredData.map(member => member.baijiu * 3);
            const beerData = filteredData.map(member => member.beer);
            const redData = filteredData.map(member => member.red * 4.125);
            const qingdaoData = filteredData.map(member => member.qingdao * 0.775);
            
            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: filteredData.map(member => member.name),
                    datasets: [
                        {
                            label: 'ç™½é…’æ¢ç®—',
                            data: baijiuData,
                            backgroundColor: wineTypes.find(w => w.id === 'baijiu').color,
                            borderColor: wineTypes.find(w => w.id === 'baijiu').color,
                            borderWidth: 1,
                            borderRadius: 6,
                            barPercentage: 0.7
                        },
                        {
                            label: 'å•¤é…’',
                            data: beerData,
                            backgroundColor: wineTypes.find(w => w.id === 'beer').color,
                            borderColor: wineTypes.find(w => w.id === 'beer').color,
                            borderWidth: 1,
                            borderRadius: 6,
                            barPercentage: 0.7
                        },
                        {
                            label: 'çº¢é…’æ¢ç®—',
                            data: redData,
                            backgroundColor: wineTypes.find(w => w.id === 'red').color,
                            borderColor: wineTypes.find(w => w.id === 'red').color,
                            borderWidth: 1,
                            borderRadius: 6,
                            barPercentage: 0.7
                        },
                        {
                            label: 'é’å²›ç»å…¸æ¢ç®—',
                            data: qingdaoData,
                            backgroundColor: wineTypes.find(w => w.id === 'qingdao').color,
                            borderColor: wineTypes.find(w => w.id === 'qingdao').color,
                            borderWidth: 1,
                            borderRadius: 6,
                            barPercentage: 0.7
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `2026å¹´${parseInt(monthSelect.value)}æœˆé¥®é…’ç»Ÿè®¡ï¼ˆå•¤é…’ï¼‰`,
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: 'var(--text-primary)'
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14
                                },
                                color: 'var(--text-primary)'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: 'var(--text-primary)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'var(--border-color)'
                            },
                            ticks: {
                                font: {
                                    size: 13
                                },
                                color: 'var(--text-secondary)'
                            },
                            title: {
                                display: true,
                                text: 'å•¤é…’ï¼ˆç“¶ï¼‰',
                                font: {
                                    size: 15,
                                    weight: 'bold'
                                },
                                color: 'var(--text-primary)'
                            }
                        }
                    }
                }
            });
        }
        
        // è®¡ç®—å¹´åº¦æ’å
        function calculateYearlyRanking() {
            const yearData = {};
            
            // åˆå§‹åŒ–æˆå‘˜æ•°æ®
            members.forEach(member => {
                yearData[member] = {
                    baijiu: 0,
                    beer: 0,
                    red: 0,
                    qingdao: 0,
                    beerTotal: 0
                };
            });
            
            // éå†æ‰€æœ‰æ—¥æœŸï¼Œç´¯åŠ å…¨å¹´æ•°æ®
            Object.entries(drinkData).forEach(([date, dateData]) => {
                if (date.startsWith('2026')) {
                    Object.entries(dateData).forEach(([member, memberData]) => {
                        const baijiu = parseFloat(memberData.baijiu) || 0;
                        const beer = parseFloat(memberData.beer) || 0;
                        const red = parseFloat(memberData.red) || 0;
                        const qingdao = parseFloat(memberData.qingdao) || 0;
                        
                        yearData[member].baijiu += baijiu;
                        yearData[member].beer += beer;
                        yearData[member].red += red;
                        yearData[member].qingdao += qingdao;
                        yearData[member].beerTotal += calculateBeer(baijiu, beer, red, qingdao);
                    });
                }
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
            const rankingArray = members.map(member => ({
                name: member,
                baijiu: yearData[member].baijiu,
                beer: yearData[member].beer,
                red: yearData[member].red,
                qingdao: yearData[member].qingdao,
                beerTotal: yearData[member].beerTotal
            })).sort((a, b) => b.beerTotal - a.beerTotal);
            
            return rankingArray;
        }
        
        // æ›´æ–°å¹´åº¦æ’åæ˜¾ç¤º
        function updateYearlyRanking() {
            const rankingArray = calculateYearlyRanking();
            const yearlyRanking = document.getElementById('yearlyRanking');
            
            if (rankingArray.length === 0 || rankingArray.every(m => m.beerTotal === 0)) {
                yearlyRanking.innerHTML = '<div class="empty-state"><i class="fas fa-glass-cheers"></i><p>å…¨å¹´æš‚æ— é¥®é…’è®°å½•</p></div>';
                return;
            }
            
            yearlyRanking.innerHTML = '';
            
            rankingArray.forEach((member, index) => {
                if (member.beerTotal === 0) return;
                
                const rankingItem = document.createElement('div');
                rankingItem.className = 'stat-item';
                
                // æ ¹æ®æ’åæ·»åŠ å¥–æ¯å›¾æ ‡
                let trophyIcon = '';
                if (index === 0) trophyIcon = 'ğŸ‘‘';
                else if (index === 1) trophyIcon = 'ğŸ¥ˆ';
                else if (index === 2) trophyIcon = 'ğŸ¥‰';
                
                rankingItem.innerHTML = `
                    <div class="stat-info">
                        <div class="rank-number ${index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank-other'}">
                            ${index + 1}
                        </div>
                        <div class="member-details">
                            <div class="member-name-rank">${trophyIcon} ${member.name} ${trophyIcon}</div>
                            <div class="member-wine-details">
                                <span class="wine-badge wine-baijiu">ç™½ ${member.baijiu.toFixed(1)}æ¯</span>
                                <span class="wine-badge wine-beer">å•¤ ${member.beer.toFixed(1)}ç“¶</span>
                                <span class="wine-badge wine-red">çº¢ ${member.red.toFixed(1)}ç“¶</span>
                                <span class="wine-badge wine-qingdao">é’ ${member.qingdao.toFixed(1)}ç“¶</span>
                            </div>
                        </div>
                    </div>
                    <span class="total-count">${member.beerTotal.toFixed(1)} ç“¶</span>
                `;
                yearlyRanking.appendChild(rankingItem);
            });
            
            // æ›´æ–°å¹´åº¦å›¾è¡¨
            updateYearlyChart(rankingArray);
        }
        
        // æ›´æ–°å¹´åº¦å›¾è¡¨
        function updateYearlyChart(rankingArray) {
            const ctx = document.getElementById('yearlyChart').getContext('2d');
            
            // é”€æ¯ä¹‹å‰çš„å›¾è¡¨
            if (yearlyChart) {
                yearlyChart.destroy();
            }
            
            // è¿‡æ»¤æ‰æ€»é‡ä¸º0çš„æˆå‘˜
            const filteredData = rankingArray.filter(member => member.beerTotal > 0);
            
            if (filteredData.length === 0) {
                document.getElementById('yearlyChart').style.display = 'none';
                return;
            }
            
            document.getElementById('yearlyChart').style.display = 'block';
            
            // è®¡ç®—å„ç±»é…’çš„å•¤é…’
            const baijiuData = filteredData.map(member => member.baijiu * 3);
            const beerData = filteredData.map(member => member.beer);
            const redData = filteredData.map(member => member.red * 4.125);
            const qingdaoData = filteredData.map(member => member.qingdao * 0.775);
            
            yearlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: filteredData.map(member => member.name),
                    datasets: [
                        {
                            label: 'ç™½é…’æ¢ç®—',
                            data: baijiuData,
                            backgroundColor: wineTypes.find(w => w.id === 'baijiu').color,
                            borderColor: wineTypes.find(w => w.id === 'baijiu').color,
                            borderWidth: 1,
                            borderRadius: 6,
                            barPercentage: 0.7
                        },
                        {
                            label: 'å•¤é…’',
                            data: beerData,
                            backgroundColor: wineTypes.find(w => w.id === 'beer').color,
                            borderColor: wineTypes.find(w => w.id === 'beer').color,
                            borderWidth: 1,
                            borderRadius: 6,
                            barPercentage: 0.7
                        },
                        {
                            label: 'çº¢é…’æ¢ç®—',
                            data: redData,
                            backgroundColor: wineTypes.find(w => w.id === 'red').color,
                            borderColor: wineTypes.find(w => w.id === 'red').color,
                            borderWidth: 1,
                            borderRadius: 6,
                            barPercentage: 0.7
                        },
                        {
                            label: 'é’å²›ç»å…¸æ¢ç®—',
                            data: qingdaoData,
                            backgroundColor: wineTypes.find(w => w.id === 'qingdao').color,
                            borderColor: wineTypes.find(w => w.id === 'qingdao').color,
                            borderWidth: 1,
                            borderRadius: 6,
                            barPercentage: 0.7
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '2026å¹´åº¦é¥®é…’ç»Ÿè®¡ï¼ˆå•¤é…’ï¼‰',
                            font: {
                                size: 20,
                                weight: 'bold'
                            },
                            color: 'var(--text-primary)'
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 15
                                },
                                color: 'var(--text-primary)'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 15,
                                    weight: 'bold'
                                },
                                color: 'var(--text-primary)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'var(--border-color)'
                            },
                            ticks: {
                                font: {
                                    size: 14
                                },
                                color: 'var(--text-secondary)'
                            },
                            title: {
                                display: true,
                                text: 'å•¤é…’ï¼ˆç“¶ï¼‰',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                color: 'var(--text-primary)'
                            }
                        }
                    }
                }
            });
        }
        
        // ==================== å¯¼å‡ºåŠŸèƒ½å‡½æ•° ====================
        // å¯¼å‡ºExcelæ–‡ä»¶ï¼ˆå½“æ—¥ï¼‰
        function exportToExcel() {
            try {
                // å‡†å¤‡æ•°æ®
                const wsData = [];
                
                // æ ‡é¢˜è¡Œ
                const titleRow = ['é…’è’™å­åä¼šé¥®é…’ç»Ÿè®¡ï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰', '', '', '', '', '', ''];
                wsData.push(titleRow);
                
                // æ¢ç®—æ ‡å‡†
                const conversionRow = ['å•ä½æ¢ç®—æ ‡å‡†ï¼š1æ¯ç™½é…’=3ç“¶å•¤é…’ï¼Œ1ç“¶çº¢é…’=4.125ç“¶å•¤é…’ï¼Œ1ç“¶é’å²›ç»å…¸=0.775ç“¶å•¤é…’ï¼Œæ‰€æœ‰ç»Ÿè®¡æŒ‰å•¤é…’è®¡ç®—', '', '', '', '', '', ''];
                wsData.push(conversionRow);
                
                // æ—¥æœŸè¡Œ
                const dateRow = [`ç»Ÿè®¡æ—¥æœŸ: ${datePicker.value}`, '', '', '', '', '', ''];
                wsData.push(dateRow);
                wsData.push([]); // ç©ºè¡Œ
                
                // è¡¨å¤´
                const headerRow = ['æˆå‘˜', 'ç™½é…’ (æ¯)', 'å•¤é…’ (ç“¶)', 'çº¢é…’ (ç“¶)', 'é’å²›ç»å…¸ (ç“¶)', 'å•¤é…’ (ç“¶)', 'è¯¦ç»†æ¢ç®—'];
                wsData.push(headerRow);
                
                // æ•°æ®è¡Œ
                const dateData = getCurrentDateData();
                members.forEach(member => {
                    const memberData = dateData[member];
                    const baijiu = parseFloat(memberData.baijiu) || 0;
                    const beer = parseFloat(memberData.beer) || 0;
                    const red = parseFloat(memberData.red) || 0;
                    const qingdao = parseFloat(memberData.qingdao) || 0;
                    const beerTotal = calculateBeer(baijiu, beer, red, qingdao);
                    const conversionDetail = `${baijiu}æ¯Ã—3 + ${beer}ç“¶Ã—1 + ${red}ç“¶Ã—4.125 + ${qingdao}ç“¶Ã—0.775`;
                    
                    const row = [
                        member,
                        baijiu,
                        beer,
                        red,
                        qingdao,
                        beerTotal,
                        conversionDetail
                    ];
                    wsData.push(row);
                });
                
                // ç©ºè¡Œ
                wsData.push([]);
                
                // ç»Ÿè®¡è¡Œ
                let totalBaijiu = 0, totalBeer = 0, totalRed = 0, totalQingdao = 0;
                members.forEach(member => {
                    const memberData = dateData[member];
                    totalBaijiu += parseFloat(memberData.baijiu) || 0;
                    totalBeer += parseFloat(memberData.beer) || 0;
                    totalRed += parseFloat(memberData.red) || 0;
                    totalQingdao += parseFloat(memberData.qingdao) || 0;
                });
                
                const totalBeerTotal = calculateBeer(totalBaijiu, totalBeer, totalRed, totalQingdao);
                const totalRow = ['æ€»è®¡', totalBaijiu, totalBeer, totalRed, totalQingdao, totalBeerTotal, ''];
                wsData.push(totalRow);
                
                // åˆ›å»º worksheet
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // è®¾ç½®åˆ—å®½
                const wscols = [
                    {wch: 10}, // æˆå‘˜åˆ—
                    {wch: 12}, // ç™½é…’åˆ—
                    {wch: 12}, // å•¤é…’åˆ—
                    {wch: 12}, // çº¢é…’åˆ—
                    {wch: 15}, // é’å²›ç»å…¸åˆ—
                    {wch: 15}, // å•¤é…’åˆ—
                    {wch: 30}  // è¯¦ç»†æ¢ç®—åˆ—
                ];
                ws['!cols'] = wscols;
                
                // åˆ›å»º workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "å½“æ—¥ç»Ÿè®¡");
                
                // ç”Ÿæˆæ–‡ä»¶å
                const fileName = `é…’è’™å­åä¼š_${datePicker.value}_é¥®é…’ç»Ÿè®¡_äº‘ç«¯åŒæ­¥ç‰ˆ.xlsx`;
                
                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, fileName);
                
                showStatus('Excelæ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (e) {
                console.error('å¯¼å‡ºExcelæ—¶å‡ºé”™:', e);
                showStatus('å¯¼å‡ºExcelæ—¶å‡ºé”™ï¼', 'error');
            }
        }
        
        // å¯¼å‡ºå½“æœˆæ•°æ®
        function exportCurrentMonthToExcel() {
            try {
                const currentDate = datePicker.value;
                const currentMonth = currentDate.substring(5, 7); // è·å–æœˆä»½
                const monthName = months.find(m => m.id === currentMonth)?.name || currentMonth + 'æœˆ';
                
                // è®¡ç®—å½“æœˆæ•°æ®
                const monthData = {};
                
                // åˆå§‹åŒ–æˆå‘˜æ•°æ®
                members.forEach(member => {
                    monthData[member] = {
                        baijiu: 0,
                        beer: 0,
                        red: 0,
                        qingdao: 0,
                        beerTotal: 0
                    };
                });
                
                // éå†æ‰€æœ‰æ—¥æœŸï¼Œç­›é€‰å‡ºå½“æœˆçš„æ•°æ®
                Object.entries(drinkData).forEach(([date, dateData]) => {
                    if (date.startsWith(`2026-${currentMonth}`)) {
                        Object.entries(dateData).forEach(([member, memberData]) => {
                            const baijiu = parseFloat(memberData.baijiu) || 0;
                            const beer = parseFloat(memberData.beer) || 0;
                            const red = parseFloat(memberData.red) || 0;
                            const qingdao = parseFloat(memberData.qingdao) || 0;
                            
                            monthData[member].baijiu += baijiu;
                            monthData[member].beer += beer;
                            monthData[member].red += red;
                            monthData[member].qingdao += qingdao;
                            monthData[member].beerTotal += calculateBeer(baijiu, beer, red, qingdao);
                        });
                    }
                });
                
                // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
                const rankingArray = members.map(member => ({
                    name: member,
                    baijiu: monthData[member].baijiu,
                    beer: monthData[member].beer,
                    red: monthData[member].red,
                    qingdao: monthData[member].qingdao,
                    beerTotal: monthData[member].beerTotal
                })).sort((a, b) => b.beerTotal - a.beerTotal);
                
                // å‡†å¤‡æ•°æ®
                const wsData = [];
                
                // æ ‡é¢˜è¡Œ
                const titleRow = ['é…’è’™å­åä¼šæœˆåº¦é¥®é…’ç»Ÿè®¡ï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰', '', '', '', '', '', ''];
                wsData.push(titleRow);
                
                // æ¢ç®—æ ‡å‡†
                const conversionRow = ['å•ä½æ¢ç®—æ ‡å‡†ï¼š1æ¯ç™½é…’=3ç“¶å•¤é…’ï¼Œ1ç“¶çº¢é…’=4.125ç“¶å•¤é…’ï¼Œ1ç“¶é’å²›ç»å…¸=0.775ç“¶å•¤é…’ï¼Œæ‰€æœ‰ç»Ÿè®¡æŒ‰å•¤é…’è®¡ç®—', '', '', '', '', '', ''];
                wsData.push(conversionRow);
                
                // æ—¥æœŸè¡Œ
                const dateRow = [`ç»Ÿè®¡æœˆä»½: 2026å¹´${monthName}`, '', '', '', '', '', ''];
                wsData.push(dateRow);
                wsData.push([]); // ç©ºè¡Œ
                
                // è¡¨å¤´
                const headerRow = ['æ’å', 'æˆå‘˜', 'ç™½é…’ (æ¯)', 'å•¤é…’ (ç“¶)', 'çº¢é…’ (ç“¶)', 'é’å²›ç»å…¸ (ç“¶)', 'å•¤é…’ (ç“¶)'];
                wsData.push(headerRow);
                
                // æ•°æ®è¡Œ
                rankingArray.forEach((member, index) => {
                    const row = [
                        index + 1,
                        member.name,
                        member.baijiu,
                        member.beer,
                        member.red,
                        member.qingdao,
                        member.beerTotal
                    ];
                    wsData.push(row);
                });
                
                // ç©ºè¡Œ
                wsData.push([]);
                
                // ç»Ÿè®¡è¡Œ
                let totalBaijiu = 0, totalBeer = 0, totalRed = 0, totalQingdao = 0, grandTotal = 0;
                rankingArray.forEach(member => {
                    totalBaijiu += member.baijiu;
                    totalBeer += member.beer;
                    totalRed += member.red;
                    totalQingdao += member.qingdao;
                    grandTotal += member.beerTotal;
                });
                
                const totalRow = ['æ€»è®¡', '', totalBaijiu, totalBeer, totalRed, totalQingdao, grandTotal];
                wsData.push(totalRow);
                
                // åˆ›å»º worksheet
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // è®¾ç½®åˆ—å®½
                const wscols = [
                    {wch: 8},  // æ’ååˆ—
                    {wch: 10}, // æˆå‘˜åˆ—
                    {wch: 12}, // ç™½é…’åˆ—
                    {wch: 12}, // å•¤é…’åˆ—
                    {wch: 12}, // çº¢é…’åˆ—
                    {wch: 15}, // é’å²›ç»å…¸åˆ—
                    {wch: 15}  // å•¤é…’åˆ—
                ];
                ws['!cols'] = wscols;
                
                // åˆ›å»º workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "æœˆåº¦ç»Ÿè®¡");
                
                // ç”Ÿæˆæ–‡ä»¶å
                const fileName = `é…’è’™å­åä¼š_2026å¹´${monthName}_é¥®é…’ç»Ÿè®¡_äº‘ç«¯åŒæ­¥ç‰ˆ.xlsx`;
                
                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, fileName);
                
                showStatus('å½“æœˆExcelæ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (e) {
                console.error('å¯¼å‡ºå½“æœˆExcelæ—¶å‡ºé”™:', e);
                showStatus('å¯¼å‡ºå½“æœˆExcelæ—¶å‡ºé”™ï¼', 'error');
            }
        }
        
        // å¯¼å‡ºæœˆåº¦Excelæ–‡ä»¶
        function exportMonthToExcel() {
            try {
                const selectedMonth = monthSelect.value;
                const monthName = months.find(m => m.id === selectedMonth).name;
                const rankingArray = calculateMonthlyRanking();
                
                // å‡†å¤‡æ•°æ®
                const wsData = [];
                
                // æ ‡é¢˜è¡Œ
                const titleRow = ['é…’è’™å­åä¼šæœˆåº¦é¥®é…’ç»Ÿè®¡ï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰', '', '', '', '', '', ''];
                wsData.push(titleRow);
                
                // æ¢ç®—æ ‡å‡†
                const conversionRow = ['å•ä½æ¢ç®—æ ‡å‡†ï¼š1æ¯ç™½é…’=3ç“¶å•¤é…’ï¼Œ1ç“¶çº¢é…’=4.125ç“¶å•¤é…’ï¼Œ1ç“¶é’å²›ç»å…¸=0.775ç“¶å•¤é…’ï¼Œæ‰€æœ‰ç»Ÿè®¡æŒ‰å•¤é…’è®¡ç®—', '', '', '', '', '', ''];
                wsData.push(conversionRow);
                
                // æ—¥æœŸè¡Œ
                const dateRow = [`ç»Ÿè®¡æœˆä»½: 2026å¹´${monthName}`, '', '', '', '', '', ''];
                wsData.push(dateRow);
                wsData.push([]); // ç©ºè¡Œ
                
                // è¡¨å¤´
                const headerRow = ['æ’å', 'æˆå‘˜', 'ç™½é…’ (æ¯)', 'å•¤é…’ (ç“¶)', 'çº¢é…’ (ç“¶)', 'é’å²›ç»å…¸ (ç“¶)', 'å•¤é…’ (ç“¶)'];
                wsData.push(headerRow);
                
                // æ•°æ®è¡Œ
                rankingArray.forEach((member, index) => {
                    const row = [
                        index + 1,
                        member.name,
                        member.baijiu,
                        member.beer,
                        member.red,
                        member.qingdao,
                        member.beerTotal
                    ];
                    wsData.push(row);
                });
                
                // ç©ºè¡Œ
                wsData.push([]);
                
                // ç»Ÿè®¡è¡Œ
                let totalBaijiu = 0, totalBeer = 0, totalRed = 0, totalQingdao = 0, grandTotal = 0;
                rankingArray.forEach(member => {
                    totalBaijiu += member.baijiu;
                    totalBeer += member.beer;
                    totalRed += member.red;
                    totalQingdao += member.qingdao;
                    grandTotal += member.beerTotal;
                });
                
                const totalRow = ['æ€»è®¡', '', totalBaijiu, totalBeer, totalRed, totalQingdao, grandTotal];
                wsData.push(totalRow);
                
                // åˆ›å»º worksheet
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // è®¾ç½®åˆ—å®½
                const wscols = [
                    {wch: 8},  // æ’ååˆ—
                    {wch: 10}, // æˆå‘˜åˆ—
                    {wch: 12}, // ç™½é…’åˆ—
                    {wch: 12}, // å•¤é…’åˆ—
                    {wch: 12}, // çº¢é…’åˆ—
                    {wch: 15}, // é’å²›ç»å…¸åˆ—
                    {wch: 15}  // å•¤é…’åˆ—
                ];
                ws['!cols'] = wscols;
                
                // åˆ›å»º workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "æœˆåº¦ç»Ÿè®¡");
                
                // ç”Ÿæˆæ–‡ä»¶å
                const fileName = `é…’è’™å­åä¼š_2026å¹´${monthName}_é¥®é…’ç»Ÿè®¡_äº‘ç«¯åŒæ­¥ç‰ˆ.xlsx`;
                
                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, fileName);
                
                showStatus('æœˆåº¦Excelæ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (e) {
                console.error('å¯¼å‡ºæœˆåº¦Excelæ—¶å‡ºé”™:', e);
                showStatus('å¯¼å‡ºæœˆåº¦Excelæ—¶å‡ºé”™ï¼', 'error');
            }
        }
        
        // å¯¼å‡ºå¹´åº¦Excelæ–‡ä»¶
        function exportYearToExcel() {
            try {
                const selectedYear = yearSelect.value;
                const rankingArray = calculateYearlyRanking();
                
                // å‡†å¤‡æ•°æ®
                const wsData = [];
                
                // æ ‡é¢˜è¡Œ
                const titleRow = ['é…’è’™å­åä¼šå¹´åº¦é¥®é…’ç»Ÿè®¡ï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰', '', '', '', '', '', ''];
                wsData.push(titleRow);
                
                // æ¢ç®—æ ‡å‡†
                const conversionRow = ['å•ä½æ¢ç®—æ ‡å‡†ï¼š1æ¯ç™½é…’=3ç“¶å•¤é…’ï¼Œ1ç“¶çº¢é…’=4.125ç“¶å•¤é…’ï¼Œ1ç“¶é’å²›ç»å…¸=0.775ç“¶å•¤é…’ï¼Œæ‰€æœ‰ç»Ÿè®¡æŒ‰å•¤é…’è®¡ç®—', '', '', '', '', '', ''];
                wsData.push(conversionRow);
                
                // æ—¥æœŸè¡Œ
                const dateRow = [`ç»Ÿè®¡å¹´ä»½: ${selectedYear}å¹´`, '', '', '', '', '', ''];
                wsData.push(dateRow);
                wsData.push([]); // ç©ºè¡Œ
                
                // è¡¨å¤´
                const headerRow = ['å¹´åº¦æ’å', 'æˆå‘˜', 'ç™½é…’ (æ¯)', 'å•¤é…’ (ç“¶)', 'çº¢é…’ (ç“¶)', 'é’å²›ç»å…¸ (ç“¶)', 'å•¤é…’ (ç“¶)'];
                wsData.push(headerRow);
                
                // æ•°æ®è¡Œ
                rankingArray.forEach((member, index) => {
                    const row = [
                        index + 1,
                        member.name,
                        member.baijiu,
                        member.beer,
                        member.red,
                        member.qingdao,
                        member.beerTotal
                    ];
                    wsData.push(row);
                });
                
                // ç©ºè¡Œ
                wsData.push([]);
                
                // ç»Ÿè®¡è¡Œ
                let totalBaijiu = 0, totalBeer = 0, totalRed = 0, totalQingdao = 0, grandTotal = 0;
                rankingArray.forEach(member => {
                    totalBaijiu += member.baijiu;
                    totalBeer += member.beer;
                    totalRed += member.red;
                    totalQingdao += member.qingdao;
                    grandTotal += member.beerTotal;
                });
                
                const totalRow = ['å¹´åº¦æ€»è®¡', '', totalBaijiu, totalBeer, totalRed, totalQingdao, grandTotal];
                wsData.push(totalRow);
                
                // åˆ›å»º worksheet
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // è®¾ç½®åˆ—å®½
                const wscols = [
                    {wch: 10}, // æ’ååˆ—
                    {wch: 10}, // æˆå‘˜åˆ—
                    {wch: 12}, // ç™½é…’åˆ—
                    {wch: 12}, // å•¤é…’åˆ—
                    {wch: 12}, // çº¢é…’åˆ—
                    {wch: 15}, // é’å²›ç»å…¸åˆ—
                    {wch: 15}  // å•¤é…’åˆ—
                ];
                ws['!cols'] = wscols;
                
                // åˆ›å»º workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "å¹´åº¦ç»Ÿè®¡");
                
                // ç”Ÿæˆæ–‡ä»¶å
                const fileName = `é…’è’™å­åä¼š_${selectedYear}å¹´åº¦é¥®é…’ç»Ÿè®¡_äº‘ç«¯åŒæ­¥ç‰ˆ.xlsx`;
                
                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, fileName);
                
                showStatus('å¹´åº¦Excelæ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (e) {
                console.error('å¯¼å‡ºå¹´åº¦Excelæ—¶å‡ºé”™:', e);
                showStatus('å¯¼å‡ºå¹´åº¦Excelæ—¶å‡ºé”™ï¼', 'error');
            }
        }
        
        // å¯¼å‡ºå…¨å¹´æ‰€æœ‰æ•°æ®
        function exportAllData() {
            try {
                // åˆ›å»º workbook
                const wb = XLSX.utils.book_new();
                
                // 1. æ·»åŠ æ±‡æ€»è¡¨
                const summaryData = [];
                summaryData.push(['é…’è’™å­åä¼š2026å¹´åº¦é¥®é…’æ±‡æ€»ï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰']);
                summaryData.push(['å•ä½æ¢ç®—æ ‡å‡†ï¼š1æ¯ç™½é…’=3ç“¶å•¤é…’ï¼Œ1ç“¶çº¢é…’=4.125ç“¶å•¤é…’ï¼Œ1ç“¶é’å²›ç»å…¸=0.775ç“¶å•¤é…’ï¼Œæ‰€æœ‰ç»Ÿè®¡æŒ‰å•¤é…’è®¡ç®—']);
                summaryData.push(['ç»Ÿè®¡æ—¥æœŸï¼š', new Date().toLocaleDateString('zh-CN')]);
                summaryData.push([]);
                summaryData.push(['æˆå‘˜', 'ç™½é…’æ€»é‡ (æ¯)', 'å•¤é…’æ€»é‡ (ç“¶)', 'çº¢é…’æ€»é‡ (ç“¶)', 'é’å²›ç»å…¸æ€»é‡ (ç“¶)', 'å•¤é…’ (ç“¶)', 'å¹´åº¦æ’å']);
                
                const yearlyRanking = calculateYearlyRanking();
                yearlyRanking.forEach((member, index) => {
                    summaryData.push([member.name, member.baijiu, member.beer, member.red, member.qingdao, member.beerTotal, index + 1]);
                });
                
                // æ€»è®¡è¡Œ
                let totalBaijiu = 0, totalBeer = 0, totalRed = 0, totalQingdao = 0, grandTotal = 0;
                yearlyRanking.forEach(member => {
                    totalBaijiu += member.baijiu;
                    totalBeer += member.beer;
                    totalRed += member.red;
                    totalQingdao += member.qingdao;
                    grandTotal += member.beerTotal;
                });
                summaryData.push([]);
                summaryData.push(['å¹´åº¦æ€»è®¡', totalBaijiu, totalBeer, totalRed, totalQingdao, grandTotal, '']);
                
                const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, summaryWs, "å¹´åº¦æ±‡æ€»");
                
                // 2. æ·»åŠ æ¯æœˆæ•°æ®è¡¨
                months.forEach(month => {
                    const monthData = [];
                    monthData.push([`2026å¹´${month.name}é¥®é…’ç»Ÿè®¡ï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰`]);
                    monthData.push(['å•ä½æ¢ç®—æ ‡å‡†ï¼š1æ¯ç™½é…’=3ç“¶å•¤é…’ï¼Œ1ç“¶çº¢é…’=4.125ç“¶å•¤é…’ï¼Œ1ç“¶é’å²›ç»å…¸=0.775ç“¶å•¤é…’ï¼Œæ‰€æœ‰ç»Ÿè®¡æŒ‰å•¤é…’è®¡ç®—']);
                    monthData.push([]);
                    monthData.push(['æˆå‘˜', 'ç™½é…’ (æ¯)', 'å•¤é…’ (ç“¶)', 'çº¢é…’ (ç“¶)', 'é’å²›ç»å…¸ (ç“¶)', 'å•¤é…’ (ç“¶)', 'æœˆåº¦æ’å']);
                    
                    // è®¡ç®—æœˆåº¦æ•°æ®
                    const monthRanking = members.map(member => {
                        let baijiu = 0, beer = 0, red = 0, qingdao = 0;
                        
                        Object.entries(drinkData).forEach(([date, dateData]) => {
                            if (date.startsWith(`2026-${month.id}`)) {
                                baijiu += parseFloat(dateData[member]?.baijiu) || 0;
                                beer += parseFloat(dateData[member]?.beer) || 0;
                                red += parseFloat(dateData[member]?.red) || 0;
                                qingdao += parseFloat(dateData[member]?.qingdao) || 0;
                            }
                        });
                        
                        const beerTotal = calculateBeer(baijiu, beer, red, qingdao);
                        return { name: member, baijiu, beer, red, qingdao, beerTotal };
                    }).sort((a, b) => b.beerTotal - a.beerTotal);
                    
                    monthRanking.forEach((member, index) => {
                        monthData.push([member.name, member.baijiu, member.beer, member.red, member.qingdao, member.beerTotal, index + 1]);
                    });
                    
                    const monthWs = XLSX.utils.aoa_to_sheet(monthData);
                    XLSX.utils.book_append_sheet(wb, monthWs, month.name);
                });
                
                // 3. æ·»åŠ æ¯æ—¥è¯¦ç»†æ•°æ®è¡¨
                const dailyData = [];
                dailyData.push(['é…’è’™å­åä¼š2026æ¯æ—¥è¯¦ç»†è®°å½•ï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰']);
                dailyData.push(['å•ä½æ¢ç®—æ ‡å‡†ï¼š1æ¯ç™½é…’=3ç“¶å•¤é…’ï¼Œ1ç“¶çº¢é…’=4.125ç“¶å•¤é…’ï¼Œ1ç“¶é’å²›ç»å…¸=0.775ç“¶å•¤é…’ï¼Œæ‰€æœ‰ç»Ÿè®¡æŒ‰å•¤é…’è®¡ç®—']);
                dailyData.push([]);
                dailyData.push(['æ—¥æœŸ', 'æˆå‘˜', 'ç™½é…’ (æ¯)', 'å•¤é…’ (ç“¶)', 'çº¢é…’ (ç“¶)', 'é’å²›ç»å…¸ (ç“¶)', 'å•¤é…’ (ç“¶)']);
                
                // æŒ‰æ—¥æœŸæ’åº
                const sortedDates = Object.keys(drinkData).sort();
                
                sortedDates.forEach(date => {
                    const dateData = drinkData[date];
                    members.forEach(member => {
                        const memberData = dateData[member];
                        const baijiu = parseFloat(memberData.baijiu) || 0;
                        const beer = parseFloat(memberData.beer) || 0;
                        const red = parseFloat(memberData.red) || 0;
                        const qingdao = parseFloat(memberData.qingdao) || 0;
                        const beerTotal = calculateBeer(baijiu, beer, red, qingdao);
                        
                        if (beerTotal > 0) {
                            dailyData.push([
                                date,
                                member,
                                baijiu,
                                beer,
                                red,
                                qingdao,
                                beerTotal
                            ]);
                        }
                    });
                });
                
                const dailyWs = XLSX.utils.aoa_to_sheet(dailyData);
                XLSX.utils.book_append_sheet(wb, dailyWs, "æ¯æ—¥è®°å½•");
                
                // ç”Ÿæˆæ–‡ä»¶å
                const fileName = `é…’è’™å­åä¼š_2026å…¨å¹´é¥®é…’æ•°æ®_äº‘ç«¯åŒæ­¥ç‰ˆ.xlsx`;
                
                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, fileName);
                
                showStatus('å…¨å¹´æ•°æ®Excelæ–‡ä»¶å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (e) {
                console.error('å¯¼å‡ºå…¨å¹´æ•°æ®æ—¶å‡ºé”™:', e);
                showStatus('å¯¼å‡ºå…¨å¹´æ•°æ®æ—¶å‡ºé”™ï¼', 'error');
            }
        }
        
        // æ¸…ç©ºå½“å‰æ—¥æœŸæ•°æ®
        function clearCurrentDate() {
            if (confirm(`ç¡®å®šè¦æ¸…ç©º ${datePicker.value} çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿ`)) {
                const date = datePicker.value;
                if (drinkData[date]) {
                    // é‡ç½®ä¸º0
                    members.forEach(member => {
                        drinkData[date][member] = {
                            baijiu: 0,
                            beer: 0,
                            red: 0,
                            qingdao: 0
                        };
                    });
                    
                    // ä¿å­˜åˆ°æœ¬åœ°
                    saveDataToLocal(date, drinkData[date]);
                    
                    // ä¿å­˜åˆ°äº‘ç«¯
                    saveDataToCloud(date, drinkData[date]);
                    
                    updateTable();
                    showStatus('å½“æ—¥æ•°æ®å·²æ¸…ç©ºï¼', 'success');
                }
            }
        }
        
        // å¯¼å…¥Excelæ•°æ®
        function importExcelData(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // æ¸…ç©ºç°æœ‰æ•°æ®
                    drinkData = {};
                    
                    // å°è¯•ä»ä¸åŒçš„å·¥ä½œè¡¨è¯»å–æ•°æ®
                    let importedData = false;
                    
                    // 1. å…ˆå°è¯•è¯»å–"æ¯æ—¥è®°å½•"å·¥ä½œè¡¨
                    if (workbook.Sheets["æ¯æ—¥è®°å½•"]) {
                        const sheet = workbook.Sheets["æ¯æ—¥è®°å½•"];
                        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                        
                        // è·³è¿‡è¡¨å¤´è¡Œï¼ˆå‰4è¡Œï¼‰
                        for (let i = 4; i < jsonData.length; i++) {
                            const row = jsonData[i];
                            if (row.length >= 7) {
                                const [date, member, baijiu, beer, red, qingdao, beerTotal] = row;
                                
                                // éªŒè¯æ•°æ®æ ¼å¼
                                if (date && member && members.includes(member)) {
                                    if (!drinkData[date]) {
                                        drinkData[date] = {};
                                    }
                                    
                                    drinkData[date][member] = {
                                        baijiu: parseFloat(baijiu) || 0,
                                        beer: parseFloat(beer) || 0,
                                        red: parseFloat(red) || 0,
                                        qingdao: parseFloat(qingdao) || 0
                                    };
                                    importedData = true;
                                }
                            }
                        }
                    }
                    
                    // 2. å¦‚æœ"æ¯æ—¥è®°å½•"æ²¡æœ‰æ•°æ®ï¼Œå°è¯•è¯»å–å…¶ä»–å¯èƒ½çš„å·¥ä½œè¡¨
                    if (!importedData) {
                        for (const sheetName in workbook.Sheets) {
                            const sheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                            
                            // è·³è¿‡ç©ºè¡¨å¤´è¡Œ
                            for (let i = 0; i < jsonData.length; i++) {
                                const row = jsonData[i];
                                if (row && row.length >= 6) {
                                    // å°è¯•è§£æä¸åŒæ ¼å¼
                                    let date, member, baijiu, beer, red, qingdao;
                                    
                                    // æ£€æŸ¥æ˜¯å¦æ˜¯æ—¥æœŸæ ¼å¼
                                    if (row[0] && (typeof row[0] === 'string' || row[0] instanceof Date)) {
                                        if (row[1] && members.includes(row[1])) {
                                            date = row[0];
                                            member = row[1];
                                            baijiu = row[2];
                                            beer = row[3];
                                            red = row[4];
                                            qingdao = row[5] || 0; // é’å²›ç»å…¸å¯èƒ½ä¸å­˜åœ¨
                                        }
                                    }
                                    
                                    if (date && member) {
                                        // æ ¼å¼åŒ–æ—¥æœŸ
                                        if (date instanceof Date) {
                                            date = date.toISOString().split('T')[0];
                                        } else if (typeof date === 'string') {
                                            // ç¡®ä¿æ—¥æœŸæ ¼å¼æ­£ç¡®
                                            if (date.includes('/')) {
                                                date = date.replace(/\//g, '-');
                                            }
                                        }
                                        
                                        if (!drinkData[date]) {
                                            drinkData[date] = {};
                                        }
                                        
                                        drinkData[date][member] = {
                                            baijiu: parseFloat(baijiu) || 0,
                                            beer: parseFloat(beer) || 0,
                                            red: parseFloat(red) || 0,
                                            qingdao: parseFloat(qingdao) || 0
                                        };
                                        importedData = true;
                                    }
                                }
                            }
                        }
                    }
                    
                    if (importedData) {
                        // ä¿å­˜æ‰€æœ‰æ•°æ®åˆ°äº‘ç«¯
                        Object.entries(drinkData).forEach(([date, data]) => {
                            saveDataToCloud(date, data);
                        });
                        
                        updateTable();
                        showStatus('æ•°æ®å¯¼å…¥å¹¶åŒæ­¥åˆ°äº‘ç«¯æˆåŠŸï¼', 'success');
                    } else {
                        showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®', 'error');
                    }
                } catch (e) {
                    console.error('å¯¼å…¥æ•°æ®æ—¶å‡ºé”™:', e);
                    showStatus('å¯¼å…¥æ•°æ®æ—¶å‡ºé”™ï¼', 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // ==================== åŒæ­¥åŠŸèƒ½ ====================
        // åŒæ­¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        syncBtn.addEventListener('click', async () => {
            if (!isOnline) {
                showStatus('ç½‘ç»œæœªè¿æ¥ï¼Œæ— æ³•åŒæ­¥', 'error');
                return;
            }
            
            showStatus('æ­£åœ¨ä¸Šä¼ æœ¬åœ°æ•°æ®åˆ°äº‘ç«¯...', 'info');
            
            // é¦–å…ˆå¤„ç†åŒæ­¥é˜Ÿåˆ—
            await processSyncQueue();
            
            // ç„¶åä¸Šä¼ æ‰€æœ‰æœ¬åœ°æ•°æ®åˆ°äº‘ç«¯
            const uploadPromises = [];
            for (const date in drinkData) {
                uploadPromises.push(saveDataToCloud(date, drinkData[date]));
            }
            
            // ç­‰å¾…æ‰€æœ‰ä¸Šä¼ å®Œæˆ
            await Promise.all(uploadPromises);
            
            showStatus('æ‰€æœ‰æœ¬åœ°æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯ï¼', 'success');
        });
        
        // ==================== æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½ ====================
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // æ›´æ–°æ´»åŠ¨æ ‡ç­¾
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ˜¾ç¤ºå¯¹åº”å†…å®¹
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                            
                            // å½“åˆ‡æ¢åˆ°æœˆæ’åæˆ–å¹´æ’åæ—¶ï¼Œæ›´æ–°æ•°æ®
                            if (tabId === 'monthly') {
                                updateMonthlyRanking();
                            } else if (tabId === 'yearly') {
                                updateYearlyRanking();
                            }
                        }
                    });
                });
            });
        }
        
        // ==================== äº‹ä»¶ç›‘å¬ ====================
        // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', async function() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const today = new Date();
            const defaultDate = today.getFullYear() === 2026 ? 
                today.toISOString().split('T')[0] : '2026-01-01';
            datePicker.value = defaultDate;
            
            // åˆå§‹åŒ–æ•°æ®
            await initializeData();
            
            // æ›´æ–°è¡¨æ ¼
            updateTable();
            
            // åˆå§‹åŒ–æ ‡ç­¾é¡µ
            initTabs();
            
            // è®¾ç½®å½“å‰æœˆä»½
            const currentMonth = (new Date().getMonth() + 1).toString().padStart(2, '0');
            monthSelect.value = currentMonth;
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
            if (isOnline && syncQueue.length > 0) {
                setTimeout(() => {
                    processSyncQueue();
                }, 2000);
            }
            
            showStatus('æ¬¢è¿ä½¿ç”¨é…’è’™å­åä¼šé¥®é…’ç»Ÿè®¡ç³»ç»Ÿï¼ˆäº‘ç«¯åŒæ­¥ç‰ˆï¼‰ï¼', 'success');
        });
        
        // å…¶ä»–äº‹ä»¶ç›‘å¬å™¨
        datePicker.addEventListener('change', updateTable);
        exportBtn.addEventListener('click', exportToExcel);
        exportCurrentMonthBtn.addEventListener('click', exportCurrentMonthToExcel);
        clearBtn.addEventListener('click', clearCurrentDate);
        exportAllBtn.addEventListener('click', exportAllData);
        exportMonthBtn.addEventListener('click', exportMonthToExcel);
        exportYearBtn.addEventListener('click', exportYearToExcel);
        monthSelect.addEventListener('change', updateMonthlyRanking);
        
        // å¯¼å…¥æŒ‰é’®äº‹ä»¶
        importBtn.addEventListener('click', function() {
            importFile.click();
        });
        
        importFile.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                importExcelData(file);
                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œä»¥ä¾¿å¯ä»¥å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶
                importFile.value = '';
            }
        });
        
        // æ¯30ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡å½“å‰æ•°æ®
        setInterval(() => {
            const date = datePicker.value;
            const currentData = getCurrentDateData();
            if (Object.keys(currentData).length > 0) {
                saveDataToCloud(date, currentData);
            }
        }, 30000);
        
        // æ¯åˆ†é’Ÿè‡ªåŠ¨ä»äº‘ç«¯åŠ è½½æœ€æ–°æ•°æ®
        setInterval(async () => {
            if (isOnline) {
                const cloudData = await loadDataFromCloud();
                // åˆå¹¶æ•°æ®ï¼ˆäº‘ç«¯æ•°æ®è¦†ç›–æœ¬åœ°ï¼‰
                drinkData = { ...drinkData, ...cloudData };
                updateDataStats();
            }
        }, 60000);
    </script>
</body>
</html>
